generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Franchise {
  id          String     @id @default(uuid())
  name        String     @unique
  type        DesignType
  description String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  designs     Design[]

  @@map("franchises")
}

model Design {
  id          String       @id @default(uuid())
  name        String
  description String?
  imageUrl    String?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  franchiseId String
  franchise   Franchise    @relation(fields: [franchiseId], references: [id])
  dtfTextiles DtfTextile[]
  tshirts     Tshirt[]

  @@map("designs")
}

model Category {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("categories")
}

model Product {
  id               String            @id @default(uuid())
  sku              String            @unique
  name             String
  description      String?
  basePrice        Decimal           @db.Decimal(10, 2)
  costPrice        Decimal           @db.Decimal(10, 2)
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  categoryId       String
  dtfTextile       DtfTextile?
  category         Category          @relation(fields: [categoryId], references: [id])
  stockMovements   StockMovement[]
  transactionItems TransactionItem[]
  tshirt           Tshirt?

  @@map("products")
}

model Tshirt {
  id        String     @id @default(uuid())
  productId String     @unique
  size      TshirtSize
  color     String
  stock     Int        @default(0)
  designId  String
  design    Design     @relation(fields: [designId], references: [id])
  product   Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([size, color, designId])
  @@map("tshirts")
}

model DtfTextile {
  id        String   @id @default(uuid())
  productId String   @unique
  width     Decimal? @db.Decimal(5, 2)
  height    Decimal? @db.Decimal(5, 2)
  stock     Int      @default(0)
  designId  String
  design    Design   @relation(fields: [designId], references: [id])
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("dtf_textiles")
}

model PaymentMethod {
  id           String        @id @default(uuid())
  name         String        @unique
  description  String?
  feePercent   Decimal       @default(0) @db.Decimal(5, 2)
  feeFixed     Decimal       @default(0) @db.Decimal(10, 2)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]

  @@map("payment_methods")
}

model Transaction {
  id              String            @id @default(uuid())
  transactionDate DateTime          @default(now())
  subtotal        Decimal           @db.Decimal(10, 2)
  discount        Decimal           @default(0) @db.Decimal(10, 2)
  paymentFee      Decimal           @default(0) @db.Decimal(10, 2)
  total           Decimal           @db.Decimal(10, 2)
  notes           String?
  status          TransactionStatus @default(COMPLETED)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  paymentMethodId String
  items           TransactionItem[]
  paymentMethod   PaymentMethod     @relation(fields: [paymentMethodId], references: [id])

  @@map("transactions")
}

model TransactionItem {
  id            String      @id @default(uuid())
  quantity      Int
  unitPrice     Decimal     @db.Decimal(10, 2)
  totalPrice    Decimal     @db.Decimal(10, 2)
  createdAt     DateTime    @default(now())
  transactionId String
  productId     String
  product       Product     @relation(fields: [productId], references: [id])
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("transaction_items")
}

model StockMovement {
  id           String       @id @default(uuid())
  movementType MovementType
  quantity     Int
  reason       String?
  reference    String?
  createdAt    DateTime     @default(now())
  productId    String
  product      Product      @relation(fields: [productId], references: [id])

  @@map("stock_movements")
}

enum TshirtSize {
  XS
  S
  M
  L
  XL
  XXL
  XXXL
}

enum TransactionStatus {
  PENDING
  COMPLETED
  CANCELLED
  REFUNDED
}

enum MovementType {
  PURCHASE
  SALE
  ADJUSTMENT
  RETURN
  TRANSFER
  DAMAGED
}

enum DesignType {
  ANIME
  CARTOON
}
